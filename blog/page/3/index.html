
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>/usr/sbin/blog</title>
  <meta name="author" content="Alex Beal">

  
  <meta name="description" content="The matrix equation in the last post can actually be whittled down a bit further to produce another equation that, in some ways, is easier to work &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.usrsb.in/blog/page/3/">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="/blog/javascripts/ender.js"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/blog/atom.xml" rel="alternate" title="/usr/sbin/blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27836693-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">/usr/sbin/blog</a></h1>
  
    <h2>Alex's Geekery Journal.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.usrsb.in" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="http://usrsb.in">Home</a></li>
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/tools">Tools</a></li>
  <li><a href="/blog/about">About</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/blog/2011/08/03/fibonacci-sequence-part-ii/">Fibonacci Sequence, Part II</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-08-03T16:49:00-06:00" pubdate data-updated="true">Aug 3<span>rd</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/blog/2011/08/03/fibonacci-sequence-part-ii/">&infin;</a>
        
      </p>
    
  </header>

<div class="entry-content"><p>The matrix equation in the last post can actually be whittled down a bit further to produce another equation that, in some ways, is easier to work with. The result is as follows:</p>

<p><img src="http://media.usrsb.in/fib2/fib.png" alt="fib" /></p>

<p>F<sub>k</sub> is, of course, the k<sup>th</sup> Fibonacci number. Now, before I go on, I want to point out that I stumbled upon these two equations and the proofs for these equations in <a href="http://www-math.mit.edu/~gs/">Gilbert Strang&#8217;s</a> excellent <a href="http://www.amazon.com/Linear-Algebra-Applications-Gilbert-Strang/dp/0030105676/ref=sr_1_2?s=books&amp;ie=UTF8&amp;qid=1312385275&amp;sr=1-2">Linear Algebra and Its Applications</a>. All credit goes to him for coming up with this, and I recommend his book for an even more in depth explanation.</p>

<p>Anyway, back to the equation, which I found interesting for a few reasons:</p>

<ol>
<li>This equation allows you to easily find the kth term using only a pocket calculator. The last equation requires something that can deal with matrices.</li>
<li>This also makes it easier to use in programming applications. There&#8217;s no need to write functions or import libraries to deal with matrices. It&#8217;s also probably faster than writing some sort of recursive function to compute the kth Fibonacci number.</li>
<li>As Strang points out, that equation, amazingly, produces an integer, despite all the fractions and square roots.</li>
<li>We can simplify that equation further for a very good approximation (so good that it&#8217;s not really an approximation).</li>
</ol>


<p>To see how we get that equation from the equation in the last post, let&#8217;s begin with the way Mr. Strang has it written in his book (it&#8217;s the same as mine, but flipped upside down).</p>

<p><img src="http://media.usrsb.in/fib2/fibmat.png" alt="title" /></p>

<p>Where F<sub>0</sub>=0, F<sub>1</sub>=1, F<sub>2</sub>=1, etc. Let&#8217;s now make some substitutions:</p>

<p><img src="http://media.usrsb.in/fib2/subs.png" alt="title" /></p>

<p>We now have:</p>

<p><img src="http://media.usrsb.in/fib2/matform.png" alt="title" /></p>

<p>This hasn&#8217;t changed the content of the equation at all. We&#8217;ve just substituted in new symbols to represent the different terms.</p>

<p>The next step is to diagonalize the matrix A. Remember that diagonalizing A produces A = SΛS<sup>-1</sup> where S contains A&#8217;s eigenvectors and Λ contains A&#8217;s eigenvalues. Substituting A = SΛS<sup>-1</sup> into the previous equation yields:</p>

<p><img src="http://media.usrsb.in/fib2/diag.png" alt="title" /></p>

<p>Notice how everything but the first and last S and S<sup>-1</sup> cancel, giving the final form: SΛ<sup>k</sup>S<sup>-1</sup>u<sub>0</sub>. This is important, because Λ is a diagonal matrix, making Λ<sup>k</sup> very simple:</p>

<p><img src="http://media.usrsb.in/fib2/lampow.png" alt="title" /></p>

<p>λ<sub>1</sub> and λ<sub>2</sub> are, of course, the eigenvalues of A. Let&#8217;s now make one last substitution and put all this diagonalization stuff together. First we define c as</p>

<p><img src="http://media.usrsb.in/fib2/csub.png" alt="title" /></p>

<p>Then we substitute it into the equation:</p>

<p><img src="http://media.usrsb.in/fib2/diag2.png" alt="title" /></p>

<p>That might need some explaining. The first bit is simply the equation with c substituted in. Following that, the first matrix is S, but written to show that it contains x<sub>1</sub> and x<sub>2</sub>, which are the eigenvectors of A placed vertically in the two columns. The middle matrix is Λ<sup>k</sup> and the last is simply the matrix c. Finally, the matrices are multiplied out, yielding the final c<sub>1</sub>λ<sup>k</sup><sub>1</sub>x<sub>1</sub>+c<sub>2</sub>λ<sup>k</sup><sub>2</sub>x<sub>2</sub></p>

<p>The final steps are simply to compute c, and A&#8217;s eigenvalues and eigenvectors. I&#8217;ll spare you the tedious algebra and simply tell you that:</p>

<p><img src="http://media.usrsb.in/fib2/eigenvals.png" alt="title" /></p>

<p><img src="http://media.usrsb.in/fib2/eigenvec.png" alt="title" /></p>

<p>This can be computed the standard way, by solving: det(A-λI)=0.</p>

<p>All the variables are then plugged into the equation for u<sub>k</sub>.</p>

<p><img src="http://media.usrsb.in/fib2/almost-there.png" alt="title" /></p>

<p>We want F<sub>k</sub>, so we multiply, factor, and take the bottom row, giving the equation we want:</p>

<p><img src="http://media.usrsb.in/fib2/approx.png" alt="title" /></p>

<p>That&#8217;s the full equation, but now notice that the second term is always less than 1/2. This mean we can simply drop it, yielding:</p>

<p>In fact, since the second term is always less than 1/2 and the full equation always gives us an integer, we can take this a step further: <strong>Rounding the approximation to the nearest integer will always give you the exact value for F<sub>k</sub>.</strong> Cool.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/blog/2011/04/10/using-matrices-to-generate-the-fibonacci-sequence/">Using Matrices to Generate the Fibonacci Sequence</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-04-10T12:47:00-06:00" pubdate data-updated="true">Apr 10<span>th</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/blog/2011/04/10/using-matrices-to-generate-the-fibonacci-sequence/">&infin;</a>
        
      </p>
    
  </header>

<div class="entry-content"><p>Here&#8217;s a fun little matrix:</p>

<p><img src="http://media.usrsb.in/fib-mat/equation.png" alt="Fib Matrix" /></p>

<p>That generates the a<sub>n</sub> and a<sub>n+1</sub> terms of the Fibonacci sequence.<sup>1</sup> To see why, let&#8217;s look at a recursive definition of the Fibonacci sequence.</p>

<p><img src="http://media.usrsb.in/fib-mat/1.png" alt="Fib Def" /></p>

<p><img src="http://media.usrsb.in/fib-mat/2.png" alt="Fib Def" /></p>

<p>That&#8217;s easy enough to understand. The first and second terms are both 1, and the next term is the sum of the last term plus the current term. To see how this relates to the matrix above, we must turn this into a matrix equation. The trick here is to have a good understanding of matrix multiplication. If you need a refresher, <a href="http://www.mathsisfun.com/algebra/matrix-multiplying.html">here&#8217;s a site</a> with a tutorial. Let&#8217;s look at an example of a 2x2 matrix multiplied by a 2x1 (even if you have a good understanding of matrix multiplication, hang tight, this is going somewhere).</p>

<p><img src="http://media.usrsb.in/fib-mat/3.png" alt="title" /></p>

<p>Now let&#8217;s make some substitutions and multiply it out:</p>

<p><img src="http://media.usrsb.in/fib-mat/7.png" alt="title" /></p>

<p>As you can see, the effect of multiplying the b matrix by the Fibonacci matrix is that it moves the b<sub>1,2</sub> position to the b<sub>1,1</sub> position, and the b<sub>1,2</sub> gets filled with the sum of b<sub>1,1</sub> and b<sub>1,2</sub>. Let&#8217;s now substitute the b&#8217;s for a<sub>n-1</sub> and a<sub>n</sub>:</p>

<p><img src="http://media.usrsb.in/fib-mat/8.png" alt="title" /></p>

<p>Does the resultant matrix look familiar? If you look above, you&#8217;ll see that it&#8217;s the same as our recursive definition of the Fibonacci sequence! The top row is equal to the current number in the sequence (a<sub>n</sub>) and the bottom row is equal to the next number in the sequence (a<sub>n-1</sub> + a<sub>n</sub> = a<sub>n+1</sub>). Continuing to multiply the resultant matrix by the Fibonacci matrix will cause consecutive entries to be produced. Because matrix multiplication is associative, we can move our multiplication to the exponent, and multiply that result by the first two terms in the sequence (0, 1), leading to our initial matrix:</p>

<p><img src="http://media.usrsb.in/fib-mat/equation.png" alt="Fib Matrix" /></p>

<h3>References</h3>

<p>1: Strang, Gilbert. &#8221;<a href="http://www.amazon.com/Linear-Algebra-Applications-Gilbert-Strang/dp/0030105676/ref=sr_1_2?s=books&amp;ie=UTF8&amp;qid=1312385275&amp;sr=1-2">Linear Algebra and Its Applications</a>.&#8221;</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/blog/2011/04/02/using-trap-to-catch-ctrl-plus-cs-and-control-how-your-script-exits/">Using &#8216;Trap&#8217; to Catch &#8216;Ctrl + C&#8217;s and Control How Your Script Exits</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-04-02T16:00:00-06:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/blog/2011/04/02/using-trap-to-catch-ctrl-plus-cs-and-control-how-your-script-exits/">&infin;</a>
        
      </p>
    
  </header>

<div class="entry-content"><p>So you&#8217;ve written a script that creates all sorts of temporary files, and launches dozens of processes in the background, and, as is, the script runs indefinitely. The only way to quit is Ctrl + C, but once you fire off this hotkey combo, you&#8217;re left with a mess of background processes and temp files. There are lots of reasons why your script might do this. For example, I&#8217;m currently writing a download manager that sends its wget processes to the background, and creates various temporary status files. It runs indefinitely because it polls a queue file, which contains the URLs of the files it&#8217;s instructed to download. So, given all that, how is it that I get my script to clean up after itself once I deal it the fatal Ctrl + C blow (or more technically, a &#8220;signal interrupt&#8221; or &#8220;SIGINT&#8221; for short)? The trick here is to use the <code>trap</code> command along with some basic process manipulation. Here&#8217;s the syntax:</p>

<pre><code>trap 'command' signal_to_trap
</code></pre>

<p>The above bit of code will cause the <em>command</em> (or string of commands between the quotes) to execute if the script is issued a <em>signal_to_trap</em>. As is implied by the syntax, you can trap more than one type of signal. To catch the Ctrl + C combo, you usually want to trap a SIGINT, which is done as follows:</p>

<pre><code>trap 'echo "Exiting"; exit 0' INT
</code></pre>

<p>That bit of code will cause your script to print the message &#8220;Exiting&#8221; and exit with status 0 once Ctrl + C is pressed (or gets issued a SIGINT some other way). One important caveat is <strong>always remember the exit command.</strong> For example, the following code will cause your program to print &#8220;Exiting&#8221; and then continue, effectively ignoring the SIGINT. What NOT to do if you want your program to actually quit:</p>

<pre><code>trap 'echo "Exiting"' INT
</code></pre>

<p>Of course, that construct isn&#8217;t without its uses. Perhaps you want your script to immediately run some routine if Ctrl + C is entered, but you don&#8217;t want it to quit. The above bit of code would be the way to do it, but that strikes me as a confusing break from convention. Most people expect Ctrl + C to stop the currently running process. A better way to do this would be to use a USR signal. Just substitute <code>INT</code> for <code>USR1</code> or <code>USR2</code>, and send the <code>USR</code> signal to the script using the kill command: <code>kill -USR1 pid</code>. In any case, back to the topic at hand: exiting a script cleanly.</p>

<h2>&#8216;Trapping&#8217; and Cleaning Up After Yourself</h2>

<p>The way I use &#8216;trap&#8217; is something along these lines:</p>

<pre><code>exit_routine () {
    # TODO: Clean up stuff.
}
trap 'exit_routine' INT # Intercept SIGINT and call exit_routine
</code></pre>

<p>If it&#8217;s short enough, you can, of course, cram your entire exit routine between the single quotes, but if it&#8217;s nontrivial it&#8217;s best to pull it out into its own function. Also remember that BASH executes a script&#8217;s commands in the order it sees them, so this must be placed somewhere near the beginning of the script to set the <code>trap</code> early on. (Perhaps that&#8217;s obvious, but I&#8217;d be the first to admit that that&#8217;s just the sort of pitfall I&#8217;d waste an hour puzzling over.) Also remember that the function must be declared before the <code>trap</code> statement (or at least before the script receives a SIGINT and tries to call <code>exit_routine</code>).</p>

<h2>Cleaning Up Stuff (Processes)</h2>

<p>Now that we&#8217;ve declared the exit routine and set the trap, we need to do some actual housekeeping. I do this by keeping track of all the background processes&#8217; PIDs and temporary files&#8217; filenames in an array. Consider the following code:</p>

<pre><code>for i in $(seq 3); do
    wget "$URL[$i]" &amp; 
    PIDS[$i]=$!
done
</code></pre>

<p>Three <code>wget</code> instances are launched and sent to the background with the <code>&amp;</code> operator. Their PIDs are accessed with the <code>$!</code> variable and stored to <code>$PIDS</code>. We can now kill off those processes with the following bit of code:</p>

<pre><code>exit_routine () {
    kill ${PIDS[*]}
    echo "Script exiting."
    exit 0
}
trap 'exit_routine' INT
</code></pre>

<p>Whenever Ctrl + C is pressed, the SIGINT is trapped and <code>exit_routine</code> is called. <code>kill</code> is then given all the PIDs, which are accessed using <code>${PIDS[*]}</code>. This kills the wget processes, an exit message is printed, and the script is exited. The neat thing about the <code>${ARRAY[*]}</code> way of accessing all an array&#8217;s elements is that empty elements won&#8217;t be returned. So if I do:</p>

<pre><code>PIDS[5]="5"
PIDS[10]="10"
echo ${PIDS[*]}
</code></pre>

<p>Then only &#8220;5 10&#8221; is printed.</p>

<h2>Dealing with Temp Files</h2>

<p>Erasing temp files is a bit more tricky. The possibility of white space characters in a file&#8217;s name makes <code>rm ${FILES[*]}</code> troublesome. Enclosing the array in double quotes doesn&#8217;t help either. Instead, we need to step through the array as follows:</p>

<pre><code>for i in $(seq 3); do
    rm "${FILES[$i]}"
done
</code></pre>

<p>If we want to ignore the empty elements of <code>$FILES</code> like <code>${PIDS[*]}</code> automatically did for the PIDs, then we can test if an element is empty using an if statement. Alternatively, you can impress your friends with some BASH-fu and take advantage of BASH&#8217;s short circuit functionality:</p>

<pre><code>for i in $(seq 3); do
    [ "${FILES[$i]}" != "" ] &amp;&amp; rm "${FILES[$i]}"
done
</code></pre>

<p>If <code>${FILES[$i]}</code> is empty, the statement short circuits, and does nothing. If it contains something, the <code>rm</code> command is executed.</p>

<p>So, that&#8217;s how it&#8217;s done. Now you have no excuse for leaving garbage behind (if only BASH had some way of automagically collecting this so called garbage!), and, as always, if you have any tips regarding this, please share your BASH-fu with us in the comments!</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/blog/2011/03/24/sending-emails-and-texts-from-the-command-line/">Sending Emails and Texts From the Command Line</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-03-24T16:39:00-06:00" pubdate data-updated="true">Mar 24<span>th</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/blog/2011/03/24/sending-emails-and-texts-from-the-command-line/">&infin;</a>
        
      </p>
    
  </header>

<div class="entry-content"><p>Here&#8217;s a handy way to send emails from the command line:</p>

<pre><code>echo 'message' | mail -s 'subject' 'email_address'
</code></pre>

<p>If you know the recipient&#8217;s carrier, you can also use it to send text messages from the command line. For example, if the recipient&#8217;s number is 111-111-1111 and she&#8217;s on Verizon, you can send her a text message using the following command:</p>

<pre><code>echo 'Sent from my terminal!' | 
    mail -s 'Linux is fun' '1111111111@vtext.com'
</code></pre>

<p>Once again, the trick here is knowing the domain name of the carrier&#8217;s <a href="http://en.wikipedia.org/wiki/SMS_Gateway">Email-to-SMS Gateway</a>. In the case of Verizon, it&#8217;s @vtext.com. Wikipedia has a handy list of other gateways <a href="http://en.wikipedia.org/wiki/List_of_SMS_gateways">here</a>. Another trick is to send yourself an email from the phone, and the phone&#8217;s SMS gateway will be revealed in the &#8216;from&#8217; field.</p>

<p>You can use this to create all sorts of fun shell scripts. For example, here&#8217;s one I wrote recently that tells me whether or not the VPS provider BuyVM has any VPSs in stock:</p>

<pre><code>#!/bin/bash -

echo 'Is BuyVM in stock?'
while :; do
        wget -O - -q http://doesbuyvmhavestock.com/ | grep -i yes
        if [ $? == 0 ]; then
                echo 'Well, what are you waiting for?' | 
                    mail -s "BuyVM is in stock" "you@example.com"
                echo 'Yes!'
                exit 0
        else
            echo 'No'
            sleep 15m
        fi
done
</code></pre>

<p>It&#8217;s pretty simple. Every 15 minutes it scrapes the webpage <a href="http://doesbuyvmhavestock.com/">doesbuyvmhavestock.com</a> and sends me an email if it contains the word &#8216;yes&#8217;. Obviously, the success of your own script depends on how well it can parse the webpage. As you can see, my parsing routine (the <code>grep</code> on line 5) is pretty primitive.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/blog/2011/03/17/backing-up-a-directorys-permissions/">Backing Up a Directory&#8217;s Permissions</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-03-17T10:39:00-06:00" pubdate data-updated="true">Mar 17<span>th</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/blog/2011/03/17/backing-up-a-directorys-permissions/">&infin;</a>
        
      </p>
    
  </header>

<div class="entry-content"><p>We&#8217;ve all done it before, and if it hasn&#8217;t happened to you yet, it&#8217;s only a matter of time. You&#8217;re attempting to set the permissions on a directory and and you&#8217;re doing something along the lines of <code>sudo chmod -R 660 ./foobar</code>. You execute the command only to realize that you&#8217;re in the wrong directory or you&#8217;ve mistyped the directory&#8217;s name, and now your permissions are totally clobbered. If you&#8217;ve kept good backups, this is annoying, but not devastating. Either you could completely restore the files, or perhaps you could write a script which would copy the old file permissions back over. An easier alternative would be to plan ahead and backup the file permissions before disaster strikes. Here&#8217;s a script that will do that for you:</p>

<pre><code>#!/bin/bash

#Check that we've been passed a directory.
if [ ! -d "$1" ]; then
   echo "$1 is not a directory. Exiting."
   exit 1
fi

#Check if we've been passed a relative or absolute
#path. If it's relative, store $PWD in $DIR. We'll need
#this later to build the absolute path.
echo "$1" | grep -q '^/'
if [ $? == 0 ]; then
   DIR='' 
else
   DIR="$PWD/"
fi

#Generate the header comments for the script.
echo "#!/bin/bash"
echo "#"
echo "#This script will restore permissions under $DIR$1"
echo "#to how they were on `date`"
echo "#"

#Loop through the given directory's tree and 
#echo the commands to restore the permissions and owner.
find "$1" -print0 | while read -d $'\0' i
do
   echo chmod `stat -c %a "$i"` \"$DIR$i\"
   echo chown `stat -c "%U:%G" "$i"` \"$DIR$i\"
done
</code></pre>

<p>What this script does is generate another script, which, when run, will restore a directory&#8217;s permissions, owner, and group (and also the permissions, owner, and group of any files and directories under it). Suppose you drop this script into a file called <code>backup.sh</code> and you want to backup the permissions of a directory called <code>/home/you/mystuff</code>. Here&#8217;s how you&#8217;d do it:</p>

<pre><code>./backup.sh /home/you/mystuff &gt; mystuff-backup.sh
</code></pre>

<p>Now when you execute <code>mystuff-backup.sh</code>, all of <code>/home/you/mystuff</code>&#8217;s permissions will be restored. Easy.</p>

<p>There is one security caveat you should keep in mind. The resultant script will contain the names of all the files and subdirectories in the directory tree. The upshot is that anyone who has read access to the script will be able to see this information. If this is a problem, you should adjust the script&#8217;s permissions accordingly.</p>

<p>The script itself is pretty straight forward. On line 4, we tell a relative path from an absolute path by seeing if it&#8217;s prefixed with a forward slash. If it is, then it&#8217;s absolute. If it isn&#8217;t, then it&#8217;s relative. We&#8217;ll need this information later to build the absolute path to all the files. The next step is to loop through the files, which is a bit tricky. On line 28, we need to pipe the output of <code>find</code> to a <code>while read</code> because the more intuitive <code>for</code> loop construct doesn&#8217;t handle spaces and newlines in filenames properly (of course, anyone who puts newlines in a filename needs to be thrown into the <a href="http://www.starwars.com/databank/creature/sarlacc/">sarlacc</a>). In fact, you may just want to memorize that line, as it&#8217;s a common problem with a far from obvious solution. Finally, on line 30 and 31, we read the file&#8217;s permission and owners with <code>stat</code>, which is a handy command that, among other things, outputs file information in a user definable format.</p>

<p>So there you have it. <a href="http://media.usrsb.in/dir-perm/backupperm.sh">Download the script here.</a> Now go forth and make this a cron job.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/blog/2011/03/12/the-first-spellchecker-in-6-lines/">The First Spellchecker (in 6 Lines)</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-03-12T15:17:00-07:00" pubdate data-updated="true">Mar 12<span>th</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/blog/2011/03/12/the-first-spellchecker-in-6-lines/">&infin;</a>
        
      </p>
    
  </header>

<div class="entry-content"><p>I recently came across this gem in a book called <a href="http://www.amazon.com/Classic-Shell-Scripting-Arnold-Robbins/dp/0596005954/">Classic Shell Scripting</a>. According to the authors, it&#8217;s a modern port of the first spellchecker. The original version was written by Steve Johnson, and was then translated into the form you see here by Kernighan and Plauger. I assume the translation was necessary because the syntax of the original isn&#8217;t compatible with modern shells. Without further ado, here it is:</p>

<pre><code>cat filename | 
  tr A-Z a-z | 
    tr -c a-z '\n' | 
      sort | 
        uniq | 
          comm -13 dictionary_file -
</code></pre>

<p>It&#8217;s a spellchecker, which, at 115 characters, fits within a tweet! Imagine that! To prove to you that it actually works, and to truly appreciate the cleverness of this code, let&#8217;s step through it line by line. The first command, &#8216;cat&#8217;, simply reads the file and sends it down the pipe. This is then processed by &#8216;tr&#8217; which converts all the uppercase characters to lower case. This is again piped to &#8216;tr&#8217;, but this time everything that&#8217;s not a lower case character is converted to a newline character. At this point, the original input has been processed down to a list of words separated by newline characters. This list is then sorted alphabetically with the &#8216;sort&#8217; command, and all the duplicate words are removed with the &#8216;uniq&#8217; command. Finally, this list of words is compared with a dictionary file. Any words that appear in the list, but not in the dictionary, are sent to standard output. The final result is a list of words that appear in your document, but not in the dictionary, and thus are probably misspelled. At this point, you may have noticed a rather serious problem with this script. It doesn&#8217;t do a very good job of handling apostrophes. The third line will remove all single quote characters, even if they&#8217;re functioning as apostrophes, and replace them with newline characters. One way to fix this is to replace line 3 with the following:</p>

<pre><code>sed -r "s/('$|^'|\W'\b|\b'\W|\W'\W)/ /g" |
  tr -c a-z\' '\n' |
</code></pre>

<p>That rather ugly &#8216;sed&#8217; command will remove all the single quote characters which aren&#8217;t in the middle of words, thereby preserving apostrophes, and the new &#8216;tr&#8217; command will ignore all single quote characters since &#8216;sed&#8217; has already dealt with them. The end result is that the apostrophe in, for example, <code>foobar's</code> will be preserved but the single quotes at the beginning and end of <code>'foobar's'</code> will be removed. Another improvement would be to keep it from removing hyphens in compound words, but I&#8217;ll leave that as an exercise to the reader. Also, If you need a dictionary file try:</p>

<pre><code>sudo apt-get install wamerican-small
</code></pre>

<p>And look under /usr/share/dict/words.</p>

<pre><code>beala@superfly:/usr/share/dict$ wc -l words
50253 words
</code></pre>

<p>That&#8217;s a lot of words! Try &#8216;wamerican-insane&#8217; if you want a, well, insane number of words.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
  <div class="pagination">
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2012/07/07/testing-with-the-poisson-process/">Testing With The Poisson Process</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2012/05/20/did-the-boulder-pd-reduce-traffic-accidents/">Did the Boulder PD Reduce Traffic Accidents?</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2012/05/05/permutations-an-interview-question/">Permutations: An Interview Question</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2012/04/07/look-ma-no-loops/">Look, Ma! No Loops: Reversing Word Order</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2012/04/01/building-data-structures-from-functions/">Building Data Structures from Functions</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/beala">@beala</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'beala',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/blog/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("beala", 4, false);
    });
  </script>
  <script src="/blog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/beala" class="twitter-follow-button" data-show-count="false">Follow @beala</a>
  
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll&#8230;</ul>
  <p><a href="http://pinboard.in/u:beala">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "beala"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Alex Beal -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'usrsbin';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
